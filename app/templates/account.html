{% extends "base.html" %}
{% block content %}
{{ super() }}
<div class="container">

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Account Information:</h3>
        </div>
        <table id="userData" class="table table-striped">
            <tbody>
                <tr>
                    <td><b>Username</b></td>
                    <td>{{session['user'].name}}</td>
                </tr>
                <tr>
                    <td><b>Email</b></td>
                    <td>{{session['user'].email}}</td>
                </tr>
                <tr>
                    <td><b>Requests Per Day</b></td>
                    <td>{{session['requests_per_day']}}</td>
                </tr>
                <tr>
                    <td><b>Upload memes to Imgur?</b></td>
                    <td>
                        <form class="form-inline" action="{{url_for('update_account')}}" method="POST">
                            <div class="form-group">
                                <label class="sr-only" for="imgur">Upload to Imgur?</label>
                                <input type="checkbox" name="imgur" id="imgur" value="1">
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <button id="updatePreferences" type="submit" class="btn btn-default">Update</button>
        <div class="panel-body">
            <span>Remaining requests today: {{session['remaining_requests_per_day']}}</span>
            <div class="progress">
                <div class="progress-bar" role="progressbar"
                    aria-valuemin="0" aria-valuemax="{{session['requests_per_day']}}" style="width:{{ session['remaining_requests_per_day'] * 10 }}%">
                    {{session['remaining_requests_per_day']}} / {{session['requests_per_day']}}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
    $(document).ready(function() {
        var upload_to_imgur = {{session['upload_to_imgur']}};
        if(upload_to_imgur) {
            $('#imgur').prop('checked', true);
        }
        $('#updatePreferences').click(function(e) {
            e.preventDefault();
            var data = {
                'upload_to_imgur': $('#imgur').is(':checked') ? 1 : 0
            };
            $.ajax({
                url: "/account/update/",
                type: 'POST',
                data: data,
                success: function(data) {
                    alert('Preferences updated!');
                },
                error: function(data) {
                    alert('Error updating preferences!');
                }
            });
        });
    });
</script>
{% endblock %}